# Download all cli binaries from the codebox-cli repo
# This job downloads the latest binaries for all OS and architectures
# from the codebox cli repository's artifact registry
download_cli:
  stage: download_dependencies
  image: dadebia/codebox-release-cli:latest
  tags:
    - docker-linux
  script:
    - ./scripts/download-cli.sh
    - |
      cli_version=$(echo "$(./bin/cli/codebox-cli-linux-amd64 version)" | sed 's/Version: //g')
    - echo CODEBOX_CLI_VERSION=$cli_version > cli_version.env
  artifacts:
    paths:
      - bin/cli
    reports:
      dotenv: cli_version.env
    expire_in: 1 hour
  when: on_success
  rules:
    - if: $CI_COMMIT_TAG
